<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/util.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/contxt-sdk-nodejs.Config.html">contxt-sdk-nodejs.Config</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.Errors.html">contxt-sdk-nodejs.Errors</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.Request.html">contxt-sdk-nodejs.Request</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.RoutesScanner.html">contxt-sdk-nodejs.RoutesScanner</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.Sdk.html">contxt-sdk-nodejs.Sdk</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.Listener.html">contxt-sdk-nodejs.sdk.Listener</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.middleware.Auth.html">contxt-sdk-nodejs.sdk.middleware.Auth</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.middleware.Auth0.html">contxt-sdk-nodejs.sdk.middleware.Auth0</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.middleware.Cors.html">contxt-sdk-nodejs.sdk.middleware.Cors</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.middleware.Handlers.html">contxt-sdk-nodejs.sdk.middleware.Handlers</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.middleware.Legacy.html">contxt-sdk-nodejs.sdk.middleware.Legacy</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.middleware.Notifier.html">contxt-sdk-nodejs.sdk.middleware.Notifier</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.middleware.Paginate.html">contxt-sdk-nodejs.sdk.middleware.Paginate</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.middleware.Permissions.html">contxt-sdk-nodejs.sdk.middleware.Permissions</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.sdk.middleware.Routers.html">contxt-sdk-nodejs.sdk.middleware.Routers</a></li>
                                <li><a href="../classes/contxt-sdk-nodejs.Util.html">contxt-sdk-nodejs.Util</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/auth.html">auth</a></li>
                                <li><a href="../modules/auth0.html">auth0</a></li>
                                <li><a href="../modules/config.html">config</a></li>
                                <li><a href="../modules/contxt.html">contxt</a></li>
                                <li><a href="../modules/cors.html">cors</a></li>
                                <li><a href="../modules/handlers.html">handlers</a></li>
                                <li><a href="../modules/legacy.html">legacy</a></li>
                                <li><a href="../modules/middleware.html">middleware</a></li>
                                <li><a href="../modules/notifier.html">notifier</a></li>
                                <li><a href="../modules/paginate.html">paginate</a></li>
                                <li><a href="../modules/permissions.html">permissions</a></li>
                                <li><a href="../modules/request.html">request</a></li>
                                <li><a href="../modules/routes.html">routes</a></li>
                                <li><a href="../modules/routescanner.html">routescanner</a></li>
                                <li><a href="../modules/sdk.html">sdk</a></li>
                                <li><a href="../modules/util.html">util</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/util.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var _ = require(&#x27;underscore&#x27;);

/**
 * Provides useful functions.
 *
 * @class Util
 * @constructor
 * @static
 * @module contxt
 * @submodule util
 * @main contxt
 * @namespace contxt-sdk-nodejs
 * @example var util = require(&#x27;contxt-sdk-nodejs&#x27;).util;
 */

var Util = function() {

  /**
   * Transform an array to an object.
   *
   * @method array_to_dictionary
   * @param {array} results - The array to be transformed.
   * @return {object} result - The transformed dictionary.
   */
  var array_to_dictionary = function(results) {
    return _.object(_.map(results, function(result) {
      return [result.key, result.value];
    }));
  };

  /**
   * Transform an array to a tree.
   *
   * @method array_to_tree
   * @param {array} array - The array to be transformed.
   * @param {object} parent - The parent node.
   * @param {object} first - Used by the recursive function.
   * @param {object} picked_fields - Fields from the tree to be in the final result.
   * @return {object} tree - The transformed tree.
   */
  var array_to_tree = function(array, parent, first, picked_fields) {
    var first = typeof first !== &#x27;undefined&#x27; ? first : false,
      tree = [];

    var children = _.filter(array, function(child) {
      return child.parent_node_id === parent.id;
    });

    if (!_.isEmpty(children)) {
      if (first) {
        tree = parent;
      }

      parent.children = children;

      _.each(children, function(child) {
        array_to_tree(array, child, false, picked_fields);
      });

      parent.children = _.map(children, function(child) {
        return _.pick(child, picked_fields);
      });
    } else {
      parent.children = [];
    }

    return _.pick(tree, picked_fields);
  };

  /**
   * Transform a tree to a multidimensional array.
   *
   * @method tree_to_array
   * @param {object} node - The tree node to start from.
   * @param {array} array - Required for recursive function.
   * @param {array} array - The tree flattened into an array.
   */
  var tree_to_array = function(node, array) {
    var array = array || [];

    if (node.id === null || node.id === undefined) {
      node.temporary_id = Math.random().toString(36).substr(2, 5);
    }

    node.parent_node_id = node.parent_node_id || null;
    array.push(_.omit(node, &#x27;children&#x27;));

    if (_.has(node, &#x27;children&#x27;)) {
      node.children.forEach(function(child) {
        child.parent_node_id = node.id || node.temporary_id;

        tree_to_array(child, array);
      });
    }

    return array;
  };

  /**
   * Returns the node parent of the provided tree.
   *
   * @method get_node_parent
   */
  var get_node_parent = function(node, tree) {
    var array = tree_to_array(tree);

    array.forEach(function(n) {
      if (node.parent_node_id === n.id) {
        return n;
      }
    });

    return false;
  };

  /**
   * Returns the children nodes of the provided node.
   *
   * @method get_node_children
   */
  var get_node_children = function(node, tree) {
    var array = tree_to_array(tree),
      children = [];

    array.forEach(function(n) {
      if (node.id === n.parent_node_id) {
        children.push(_.omit(n, &#x27;children&#x27;));
      }
    });

    return children;
  };

  /**
   * Order tree.
   *
   * @method order_tree
   */
  var order_tree = function(treeLevelNodes, count) {
    _.each(treeLevelNodes, function(node) {
      node.lft = count++;

      if (node.children.length &gt; 0) {
        count = order_tree(node.children, count);
      }

      node.rgt = count++;
    });

    return count;
  };

  /**
   * Checks for the input to be an object literal.
   *
   * @method is_dictionary
   */
  var is_dictionary = function(dictionary) {
    var _test = dictionary;

    if (typeof dictionary !== &#x27;object&#x27; || dictionary === null) {
      return false;
    } else {
      while (!false) {
        if (Object.getPrototypeOf(_test = Object.getPrototypeOf(_test)) === null) {
          break;
        }
      }

      return Object.getPrototypeOf(dictionary) === _test;
    }
  };

  /**
   * Validation.
   *
   * @method validate_part
   */
  var validate_part = function(part) {
    var supported_field_operators = [&#x27;$eq&#x27;, &#x27;$gt&#x27;, &#x27;$gte&#x27;, &#x27;$lt&#x27;, &#x27;$lte&#x27;, &#x27;$ne&#x27;, &#x27;$or&#x27;, &#x27;$and&#x27;, &#x27;$not&#x27;, &#x27;$nor&#x27;],
      supported_logical_operators = [&#x27;$or&#x27;, &#x27;$and&#x27;, &#x27;$not&#x27;, &#x27;$nor&#x27;],
      supported_field_prefixes = [&#x27;output_field_id&#x27;];

    if (_.indexOf(supported_field_operators, part.operator) == -1) {
      return &#x27;Invalid operator: &#x27; + part.operator;
    }

    // only if there are no subqueries in this part will we check the field name
    if (part.parts.length === 0) {
      var field_name = part.field.split(&#x27;::&#x27;)[0];

      if (_.indexOf(supported_field_prefixes, field_name) == -1) {
        return &#x27;Invalid prefix: &#x27; + field_name;
      }
    }

    return true;
  };

  /**
   * Determine right and left values for the tree.
   *
   * @method validate_part
   */
  var rebuild_tree_in_memory = function(parent, left) {
    parent.lft = left;
    parent.rgt = left + 1;

    if (parent.children &amp;&amp; parent.children.length &gt; 0) {
      parent.children.forEach(function(child) {
        rebuild_tree_in_memory(child, parent.rgt);

        parent.rgt = child.rgt + 1;
      });
    }
  };

  return {
    array_to_dictionary: array_to_dictionary,
    array_to_tree: array_to_tree,
    tree_to_array: tree_to_array,
    get_node_parent: get_node_parent,
    get_node_children: get_node_children,
    order_tree: order_tree,
    is_dictionary: is_dictionary,
    validate_part: validate_part,
    rebuild_tree_in_memory: rebuild_tree_in_memory
  };
};

module.exports = Util();

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
